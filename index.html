<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2D Multiplayer Game</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #1a1a2e;
            font-family: Arial, sans-serif;
            color: white;
            overflow: hidden;
        }
        #mainContainer {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        #youtubeSection {
            background: #16213e;
            padding: 15px;
            border-bottom: 3px solid #0f3460;
        }
        #youtubeInput {
            width: 60%;
            padding: 10px;
            background: #0f3460;
            border: 2px solid #00ff88;
            color: white;
            border-radius: 5px;
            font-size: 14px;
        }
        .btn {
            padding: 10px 20px;
            background: #00ff88;
            border: none;
            border-radius: 5px;
            color: #1a1a2e;
            font-weight: bold;
            cursor: pointer;
            margin-left: 10px;
        }
        .btn:hover {
            background: #00dd77;
        }
        .btn.danger {
            background: #ff4444;
        }
        .btn.danger:hover {
            background: #dd3333;
        }
        #videoPlayer {
            width: 100%;
            height: 300px;
            margin-top: 10px;
            display: none;
        }
        #connectionStatus {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            z-index: 1000;
        }
        .status-connected {
            background: #00ff88;
            color: #1a1a2e;
        }
        .status-connecting {
            background: #ffaa00;
            color: #1a1a2e;
        }
        .status-disconnected {
            background: #ff4444;
            color: white;
        }
        #gameArea {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        #leftPanel {
            width: 250px;
            background: #16213e;
            padding: 15px;
            display: flex;
            flex-direction: column;
            border-right: 3px solid #0f3460;
        }
        #centerPanel {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow: auto;
        }
        #rightPanel {
            width: 300px;
            background: #16213e;
            display: flex;
            flex-direction: column;
            border-left: 3px solid #0f3460;
        }
        canvas {
            border: 3px solid #00ff88;
            background: #0f3460;
            box-shadow: 0 0 20px rgba(0,255,136,0.3);
        }
        .skinSelector {
            margin: 20px 0;
        }
        .skinOption {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: inline-block;
            margin: 5px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s;
        }
        .skinOption:hover {
            transform: scale(1.1);
            border-color: white;
        }
        .skinOption.selected {
            border-color: #00ff88;
            box-shadow: 0 0 15px #00ff88;
        }
        #chatContainer {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 15px;
        }
        #chatMessages {
            flex: 1;
            overflow-y: auto;
            background: #0f3460;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        .chatMessage {
            margin: 5px 0;
            padding: 8px;
            background: rgba(255,255,255,0.05);
            border-radius: 5px;
            word-wrap: break-word;
            animation: fadeIn 0.3s;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .chatMessage .author {
            font-weight: bold;
            margin-right: 5px;
        }
        #chatInputArea {
            display: flex;
        }
        #chatInput {
            flex: 1;
            padding: 10px;
            background: #0f3460;
            border: 2px solid #00ff88;
            color: white;
            border-radius: 5px;
            font-size: 14px;
        }
        h3 {
            color: #00ff88;
            margin-top: 0;
        }
        #info {
            background: rgba(0,255,136,0.1);
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
        }
        .controls {
            font-size: 12px;
            color: #aaa;
            text-align: center;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div id="connectionStatus" class="status-connecting">ðŸ”„ Connecting...</div>
    
    <div id="mainContainer">
        <div id="youtubeSection">
            <div style="text-align: center;">
                <h3 style="margin: 0 0 10px 0;">ðŸŽ¥ Watch While You Play</h3>
                <input type="text" id="youtubeInput" placeholder="Paste YouTube link here (e.g., https://www.youtube.com/watch?v=...)">
                <button class="btn" id="loadVideoBtn">Load Video</button>
                <button class="btn danger" onclick="document.getElementById('videoPlayer').style.display='none';">Hide Video</button>
            </div>
            <iframe id="videoPlayer" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>
        
        <div id="gameArea">
            <div id="leftPanel">
                <h3>Choose Your Skin</h3>
                <div class="skinSelector" id="skinSelector"></div>
                
                <div id="info">
                    <div id="playerCount">Players: 0</div>
                    <div style="font-size: 11px; margin-top: 5px; color: #aaa;">Online Mode</div>
                </div>
                <div class="controls">WASD or Arrow Keys to move</div>
            </div>
            
            <div id="centerPanel">
                <canvas id="gameCanvas" width="700" height="500"></canvas>
            </div>
            
            <div id="rightPanel">
                <div id="chatContainer">
                    <h3>Chat</h3>
                    <div id="chatMessages"></div>
                    <div id="chatInputArea">
                        <input type="text" id="chatInput" placeholder="Type a message..." maxlength="100">
                        <button class="btn" id="sendBtn">Send</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // Your Railway server URL
        const SERVER_URL = 'wss://game-server-production-a445.up.railway.app';
        
        let ws = null;
        let isConnected = false;
        const connectionStatus = document.getElementById('connectionStatus');
        
        function updateConnectionStatus(status) {
            connectionStatus.className = '';
            if (status === 'connected') {
                connectionStatus.textContent = 'âœ… Connected';
                connectionStatus.classList.add('status-connected');
                isConnected = true;
            } else if (status === 'connecting') {
                connectionStatus.textContent = 'ðŸ”„ Connecting...';
                connectionStatus.classList.add('status-connecting');
                isConnected = false;
            } else {
                connectionStatus.textContent = 'âŒ Disconnected';
                connectionStatus.classList.add('status-disconnected');
                isConnected = false;
            }
        }
        
        function connectToServer() {
            try {
                updateConnectionStatus('connecting');
                ws = new WebSocket(SERVER_URL);
                
                ws.onopen = () => {
                    updateConnectionStatus('connected');
                    console.log('Connected to server!');
                    
                    ws.send(JSON.stringify({
                        type: 'join',
                        id: myId,
                        player: myPlayer
                    }));
                    
                    addChatMessage('System', 'Connected to server!', '#00ff88');
                };
                
                ws.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    
                    switch(data.type) {
                        case 'init':
                            Object.assign(players, data.players);
                            data.chatHistory.forEach(msg => {
                                addChatMessage(msg.author, msg.message, msg.color, false);
                            });
                            break;
                            
                        case 'playerJoined':
                            if (data.id !== myId) {
                                players[data.id] = data.player;
                                addChatMessage('System', `${data.player.name} joined the game`, '#00ff88');
                            }
                            break;
                            
                        case 'playerUpdate':
                            if (data.id !== myId && players[data.id]) {
                                players[data.id] = data.player;
                            }
                            break;
                            
                        case 'playerLeft':
                            if (players[data.id]) {
                                addChatMessage('System', `${players[data.id].name} left the game`, '#ff4444');
                                delete players[data.id];
                            }
                            break;
                            
                        case 'chat':
                            addChatMessage(data.author, data.message, data.color, false);
                            break;
                    }
                };
                
                ws.onerror = (error) => {
                    console.error('WebSocket error:', error);
                    updateConnectionStatus('disconnected');
                };
                
                ws.onclose = () => {
                    updateConnectionStatus('disconnected');
                    console.log('Disconnected from server');
                    addChatMessage('System', 'Disconnected from server', '#ff4444');
                    
                    setTimeout(() => {
                        if (!isConnected) {
                            console.log('Attempting to reconnect...');
                            connectToServer();
                        }
                    }, 5000);
                };
                
            } catch (error) {
                console.error('Connection error:', error);
                updateConnectionStatus('disconnected');
            }
        }
        
        const skins = [
            { id: 'blue', color: '#4A90E2', name: 'ðŸ”µ Blue' },
            { id: 'red', color: '#E24A4A', name: 'ðŸ”´ Red' },
            { id: 'green', color: '#4AE290', name: 'ðŸŸ¢ Green' },
            { id: 'purple', color: '#9B4AE2', name: 'ðŸŸ£ Purple' },
            { id: 'orange', color: '#E2904A', name: 'ðŸŸ  Orange' },
            { id: 'pink', color: '#E24AB8', name: 'ðŸ©· Pink' },
            { id: 'cyan', color: '#4AE2E2', name: 'ðŸ”· Cyan' },
            { id: 'yellow', color: '#E2E24A', name: 'ðŸŸ¡ Yellow' },
            { id: 'rainbow', color: 'hsl(0, 70%, 60%)', name: 'ðŸŒˆ Rainbow', special: true }
        ];
        
        const skinSelector = document.getElementById('skinSelector');
        skins.forEach((skin, index) => {
            const skinDiv = document.createElement('div');
            skinDiv.className = 'skinOption' + (index === 0 ? ' selected' : '');
            skinDiv.style.background = skin.color;
            skinDiv.title = skin.name;
            skinDiv.onclick = () => selectSkin(skin, skinDiv);
            skinSelector.appendChild(skinDiv);
        });
        
        let selectedSkin = skins[0];
        let rainbowHue = 0;
        
        function selectSkin(skin, element) {
            document.querySelectorAll('.skinOption').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
            selectedSkin = skin;
            myPlayer.skin = skin;
        }
        
        const players = {};
        let myId = Math.random().toString(36).substr(2, 9);
        
        const myPlayer = {
            x: Math.random() * (canvas.width - 40) + 20,
            y: Math.random() * (canvas.height - 40) + 20,
            vx: 0,
            vy: 0,
            skin: selectedSkin,
            name: `Player${Math.floor(Math.random() * 1000)}`
        };
        
        players[myId] = myPlayer;
        
        const keys = {};
        const speed = 4;
        
        window.addEventListener('keydown', e => {
            keys[e.key.toLowerCase()] = true;
        });
        
        window.addEventListener('keyup', e => {
            keys[e.key.toLowerCase()] = false;
        });
        
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const sendBtn = document.getElementById('sendBtn');
        
        function addChatMessage(author, message, color, broadcast = true) {
            const msgDiv = document.createElement('div');
            msgDiv.className = 'chatMessage';
            msgDiv.innerHTML = `<span class="author" style="color: ${color}">${author}:</span>${message}`;
            chatMessages.appendChild(msgDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            if (broadcast && isConnected && ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({
                    type: 'chat',
                    author: author,
                    message: message,
                    color: color
                }));
            }
        }
        
        function sendMessage() {
            const message = chatInput.value.trim();
            if (message) {
                addChatMessage(myPlayer.name, message, myPlayer.skin.color, true);
                chatInput.value = '';
            }
        }
        
        sendBtn.onclick = sendMessage;
        chatInput.addEventListener('keypress', e => {
            if (e.key === 'Enter') sendMessage();
        });
        
        const youtubeInput = document.getElementById('youtubeInput');
        const videoPlayer = document.getElementById('videoPlayer');
        const loadVideoBtn = document.getElementById('loadVideoBtn');
        
        loadVideoBtn.onclick = () => {
            const url = youtubeInput.value.trim();
            if (url) {
                let videoId = '';
                
                if (url.includes('youtube.com/watch?v=')) {
                    videoId = url.split('v=')[1].split('&')[0];
                } else if (url.includes('youtu.be/')) {
                    videoId = url.split('youtu.be/')[1].split('?')[0];
                } else if (url.includes('youtube.com/embed/')) {
                    videoId = url.split('embed/')[1].split('?')[0];
                }
                
                if (videoId) {
                    videoPlayer.src = `https://www.youtube.com/embed/${videoId}?autoplay=1`;
                    videoPlayer.style.display = 'block';
                } else {
                    alert('Invalid YouTube URL. Please paste a valid YouTube link.');
                }
            }
        };
        
        let lastUpdate = 0;
        function sendPositionUpdate() {
            const now = Date.now();
            if (now - lastUpdate > 50 && isConnected && ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({
                    type: 'update',
                    player: myPlayer
                }));
                lastUpdate = now;
            }
        }
        
        function update() {
            myPlayer.vx = 0;
            myPlayer.vy = 0;
            
            if (keys['w'] || keys['arrowup']) myPlayer.vy = -speed;
            if (keys['s'] || keys['arrowdown']) myPlayer.vy = speed;
            if (keys['a'] || keys['arrowleft']) myPlayer.vx = -speed;
            if (keys['d'] || keys['arrowright']) myPlayer.vx = speed;
            
            myPlayer.x += myPlayer.vx;
            myPlayer.y += myPlayer.vy;
            
            myPlayer.x = Math.max(20, Math.min(canvas.width - 20, myPlayer.x));
            myPlayer.y = Math.max(20, Math.min(canvas.height - 20, myPlayer.y));
            
            rainbowHue = (rainbowHue + 2) % 360;
            
            if (myPlayer.vx !== 0 || myPlayer.vy !== 0) {
                sendPositionUpdate();
            }
            
            document.getElementById('playerCount').textContent = `Players: ${Object.keys(players).length}`;
        }
        
        function draw() {
            ctx.fillStyle = '#0f3460';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.strokeStyle = 'rgba(255,255,255,0.05)';
            ctx.lineWidth = 1;
            for (let x = 0; x < canvas.width; x += 40) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            for (let y = 0; y < canvas.height; y += 40) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
            
            Object.entries(players).forEach(([id, player]) => {
                const isMe = id === myId;
                
                let playerColor = player.skin.color;
                if (player.skin.special && player.skin.id === 'rainbow') {
                    playerColor = `hsl(${rainbowHue}, 70%, 60%)`;
                }
                
                ctx.fillStyle = playerColor;
                ctx.beginPath();
                ctx.arc(player.x, player.y, 20, 0, Math.PI * 2);
                ctx.fill();
                
                if (isMe) {
                    ctx.strokeStyle = 'white';
                    ctx.lineWidth = 3;
                    ctx.stroke();
                }
                
                ctx.fillStyle = 'white';
                ctx.font = 'bold 12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(player.name, player.x, player.y - 30);
                
                if (player.vx !== 0 || player.vy !== 0) {
                    const angle = Math.atan2(player.vy, player.vx);
                    const endX = player.x + Math.cos(angle) * 30;
                    const endY = player.y + Math.sin(angle) * 30;
                    
                    ctx.strokeStyle = playerColor;
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(player.x, player.y);
                    ctx.lineTo(endX, endY);
                    ctx.stroke();
                }
            });
        }
        
        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }
        
        gameLoop();
        connectToServer();
        
        addChatMessage('System', 'Welcome! Connecting to multiplayer server...', '#00ff88', false);
    </script>
</body>
</html>
